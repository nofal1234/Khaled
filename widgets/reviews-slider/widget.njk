<!-- Reviews Section -->
{% set title_color = widget.data.title_color  %}
{% set show_navigation = widget.data.show_navigation  %}
{% set title_size = widget.data.title_size %}
{% set user_name_color = widget.data.user_name_color %}
{% set user_name_size = widget.data.user_name_size %}
{% set user_description_color = widget.data.user_description_color %}
{% set user_description_size = widget.data.user_description_size %}
{% set review_text_color = widget.data.review_text_color %}
{% set review_bg_color = widget.data.review_bg_color %}
{% set link_color = widget.data.link_color %}
<section class="mt-4 md:mt-8 mb-6 md:mb-10 container flex-col flex gap-6">
    <div class="flex items-center justify-between">
        <h1 class="md:text-[40px] text-lg md:leading-[120%] leading-[150%] font-bold " style="color: {{ link_color }}; ">{{ t(widget.data.title) }}</h1>
        {% if show_navigation %}
        <div class="flex items-center gap-[38px]" >
            <div class="cursor-pointer swiper-button-next-reviews hidden md:flex items-center justify-center bg-transparent">
                <i class="ph ph-caret-right text-lg" style="color: {{ link_color }};"></i>
            </div>
            <div class="swiper-button-prev-reviews cursor-pointer hidden md:flex items-center justify-center bg-transparent">
                <i class="ph ph-caret-left text-lg" style="color: {{ link_color }};"></i>
            </div>
        </div>
        {% endif %}
    </div>
    {% if widget.blocks | length > 0 %}

    <div class="relative">
        <div id="reviews-swiper-{{ widget.id }}" class="swiper reviewsSwiper">
            <div class="swiper-wrapper">
                {% for block in widget.blocks %}
                <div class="swiper-slide">
                    {%ui "review-card.njk",
                        review=block.data,
                        title_color=title_color,
                        title_size=title_size,
                        user_name_color=user_name_color,
                        user_name_size=user_name_size,
                        user_description_color=user_description_color,
                        user_description_size=user_description_size,
                        review_text_color=review_text_color,
                        review_bg_color=review_bg_color,
                        link_color=link_color
                    %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    
    {% else  %}
    {% ui "empty.njk" %}
          
        {% endif %}
</section>
<script>
    function initReviewsSwiper() {
      const swiperElem = document.getElementById('reviews-swiper-{{ widget.id }}');
      if (!swiperElem || !window.Swiper) return;
  
      if (swiperElem.swiper) {
        swiperElem.swiper.destroy(true, true);
      }
  
      const slidesCount =
        swiperElem.querySelectorAll('.swiper-slide').length;
  
      const autoplayEnabled = '{{ widget.data.autoplay }}' === 'true';
  
      const slidesPerViewSM = Number('{{ widget.data.slides_per_view_sm }}');
      const slidesPerViewMD = Number('{{ widget.data.slides_per_view_md }}');
      const slidesPerViewLG = Number('{{ widget.data.slides_per_view_lg }}');
  
      const spaceBetweenSM = Number('{{ widget.data.space_between_sm }}');
      const spaceBetweenMD = Number('{{ widget.data.space_between_md }}');
      const spaceBetweenLG = Number('{{ widget.data.space_between_lg }}');
  
      const allowTouchMove = '{{ widget.data.allow_touch_move }}' === 'true';
      const grabCursor = '{{ widget.data.grab_cursor }}' === 'true';
      const speed = Number('{{ widget.data.speed }}');
  
      const autoplayDelay = Number('{{ widget.data.autoplay_delay }}');
      const disableOnInteraction = '{{ widget.data.disable_on_interaction }}' === 'true';
      const pauseOnMouseEnter = '{{ widget.data.pause_on_mouse_enter }}' === 'true';
      const reverseDirection = '{{ widget.data.reverse_direction }}' === 'true';
  
      const swiper = new Swiper(swiperElem, {
        grabCursor,
        speed,
        allowTouchMove,
  
        autoplay: false,
        loop: false,
  
        navigation: {
          nextEl: '.swiper-button-next-reviews',
          prevEl: '.swiper-button-prev-reviews'
        },
  
        breakpoints: {
          0: {
            slidesPerView: slidesPerViewSM,
            spaceBetween: spaceBetweenSM
          },
          640: {
            slidesPerView: slidesPerViewMD,
            spaceBetween: spaceBetweenMD
          },
          1024: {
            slidesPerView: slidesPerViewLG,
            spaceBetween: spaceBetweenLG
          }
        },
  
        on: {
          init() {
            handleReviewsAutoplay(this);
          },
          breakpoint() {
            handleReviewsAutoplay(this);
          }
        }
      });
  
      function handleReviewsAutoplay(swiperInstance) {
        if (!autoplayEnabled) {
          swiperInstance.autoplay?.stop();
          swiperInstance.loopDestroy?.();
          swiperInstance.params.loop = false;
          return;
        }
  
        const currentSlidesPerView = Math.ceil(
          swiperInstance.params.slidesPerView
        );
  
        const shouldAutoplay = slidesCount > currentSlidesPerView;
  
        if (shouldAutoplay) {
          if (!swiperInstance.params.loop) {
            swiperInstance.params.loop = true;
            swiperInstance.loopCreate();
          }
  
          swiperInstance.params.autoplay = {
            delay: autoplayDelay,
            disableOnInteraction,
            pauseOnMouseEnter,
            reverseDirection
          };
  
          swiperInstance.autoplay.start();
        } else {
          swiperInstance.autoplay.stop();
          swiperInstance.loopDestroy();
          swiperInstance.params.loop = false;
        }
      }
    }
  
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initReviewsSwiper, { once: true });
    } else {
      initReviewsSwiper();
    }
  </script>
  

{% style %}
.swiper-button-next-reviews, .swiper-button-prev-reviews {
width: 14px;
height: 27px;
}
.reviewsSwiper .swiper-slide {
    display: flex;
    height: auto;
}
.reviewsSwiper .swiper-slide > * {
    width: 100%;
    height: 100%;
}


{% endstyle %}

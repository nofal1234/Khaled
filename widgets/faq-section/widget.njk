<section class="py-6 bg-white container flex gap-6">
    <div id="faq-app" class="flex flex-col flex-[0_0_57%] gap-4">
        <h2 class="text-2xl md:text-3xl font-bold">{{ t('more_information') }}</h2>
        <div class="flex flex-col gap-6">
            {% for block in widget.blocks %}
            <div class="border-b border-gray-200">
                <button
                    class="faq-toggle w-full flex items-center justify-between py-4 text-right hover:bg-gray-50 transition-colors"
                    aria-expanded="{% if loop.index == 1 %}true{% else %}false{% endif %}">
                    <h3 class="text-xl font-medium text-mainColor">{{ t((block.data.question |
                        default(block.settings.question)) | striptags) }}</h3>
                    <span class="faq-sign text-2xl text-gray-500 mr-4">{% if loop.index == 1 %}−{% else %}+{% endif
                        %}</span>
                </button>
                <div class="faq-content pb-4 text-right {% if loop.index != 1 %}hidden{% endif %}">
                    <p class="text-gray-700 leading-relaxed">
                        {{ t((block.data.answer | default(block.settings.answer)) | striptags) }}
                    </p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% if widget.data.show_related_products is null or widget.data.show_related_products == true %}
    <div class="flex flex-col gap-6 flex-[0_0_43%]">
        <h3 class="text-[32px] font-bold">{{t("products_you_may_like")}}</h3>
        {% if context.related_products and context.related_products|length > 0 %}
        <div class="relative">
            <div id="related-swiper-{{ widget.id }}" class="swiper">
                <div class="swiper-wrapper">
                    {% for product in context.related_products %}
                    <div class="swiper-slide">
                        {% ui "product-card.njk", product=product %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            <div class="flex items-center justify-between mt-2" dir="ltr">
                <button class="swiper-button-prev-related-{{ widget.id }} text-mainColor flex items-center gap-1">
                    <span class="text-lg">‹</span>
                </button>
                <button class="swiper-button-next-related-{{ widget.id }} text-mainColor flex items-center gap-1">
                    <span class="text-lg">›</span>
                </button>
            </div>
        </div>
        {% else %}
        <div class="text-gray-500 text-lg p-4 text-center">{{t("no_similar_products")}}</div>
        {% endif %}
    </div>
    {% endif %}
</section>
<script>
    (function () {
        var toggles = document.querySelectorAll('.faq-toggle');
        if (!toggles || !toggles.length) return;
        toggles.forEach(function (btn) {
            btn.addEventListener('click', function () {
                var expanded = btn.getAttribute('aria-expanded') === 'true';
                var content = btn.parentElement.querySelector('.faq-content');
                var sign = btn.querySelector('.faq-sign');
                if (!content || !sign) return;
                if (expanded) {
                    content.classList.add('hidden');
                    btn.setAttribute('aria-expanded', 'false');
                    sign.textContent = '+';
                } else {
                    content.classList.remove('hidden');
                    btn.setAttribute('aria-expanded', 'true');
                    sign.textContent = '−';
                }
            });
        });
    })();
    document.addEventListener('DOMContentLoaded', function () {
        var swiperEl = document.getElementById('related-swiper-{{ widget.id }}');
        if (swiperEl && window.Swiper) {
            new window.Swiper(swiperEl, {
                slidesPerView: 1.1,
                spaceBetween: 12,
                navigation: {
                    nextEl: '.swiper-button-next-related-{{ widget.id }}',
                    prevEl: '.swiper-button-prev-related-{{ widget.id }}'
                },
                breakpoints: {
                    640: {
                        slidesPerView: 2,
                        spaceBetween: 12
                    }
                }
            });
        }
    });

</script>
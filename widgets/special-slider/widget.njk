{% set view_all_link = widget.data.view_all_link %}
{% set show_view_all = widget.data.show_view_all %}
{% set link_color = widget.data.link_color %}
{% set title_color = widget.data.title_color  %}
{% set title_size = widget.data.title_size  %}
{% set show_navigation = widget.data.show_navigation %}

{% set special_name_color = widget.data.special_name_color %}
{% set special_name_size = widget.data.special_name_size %}
{% set special_description_color = widget.data.special_description_color %}
{% set special_description_size = widget.data.special_description_size %}
<section class="mt-4 md:mt-8 mb-3 md:mb-5 container py-4">
  {% if widget.blocks | length > 0 %}

  <div class="flex items-center justify-between mb-4 md:mb-6">
    <h1 class="md:text-[40px] text-lg md:leading-[120%] leading-[150%] font-bold text-center" style="color: {{ link_color }};">{{ t(widget.data.section_title) }}</h1>
    <div class="flex items-center gap-4">
      <a href="{{ widget.data.view_all_link | default('#') }}"
        class="underline text-xs md:text-sm text-black cursor-pointer hover:text-mainColor transition py-0 px-0 md:py-2 md:px-3">
        {{ t('view_all') }}
      </a>
      {% if show_navigation %}
      <div class="flex items-center gap-[38px]" >
        <div class="cursor-pointer  swiper-button-next-special  hidden md:flex items-center justify-center bg-transparent">
          <i class="ph  ph-caret-right text-lg" style="color: {{ link_color }};"></i>
        </div>
        <div class=" swiper-button-prev-special cursor-pointer hidden md:flex items-center justify-center bg-transparent">
          <i class="ph  ph-caret-left text-lg" style="color: {{ link_color }};"></i>
        </div>
      </div>
    {% endif %}
    </div>
  </div>
  <div class="relative flex">

    <div id="special-swiper-{{ widget.id }}" class="swiper specialSwiper">
      <div class="swiper-wrapper">
        {% for block in widget.blocks %}
        <div class="swiper-slide">
          {% ui "special-card.njk", special=block.data, special_name_color=special_name_color, special_name_size=special_name_size, special_description_color=special_description_color, special_description_size=special_description_size %}
        </div>
        {% endfor %}
      </div>
    </div>
    
  </div>
  {% else %}
  {% ui "empty.njk" %}

  {% endif %}
</section>
<script>
  function initSpecialSwiper() {
    const swiperElem = document.getElementById('special-swiper-{{ widget.id }}');
    if (!swiperElem || !window.Swiper) return;

    if (swiperElem.swiper) {
      swiperElem.swiper.destroy(true, true);
    }

    const slidesCount =
      swiperElem.querySelectorAll('.swiper-slide').length;

    const autoplayEnabled = '{{ widget.data.autoplay }}' === 'true';

    const slidesPerViewSM = Number('{{ widget.data.slides_per_view_sm }}');
    const slidesPerViewMD = Number('{{ widget.data.slides_per_view_md }}');
    const slidesPerViewLG = Number('{{ widget.data.slides_per_view_lg }}');

    const spaceBetweenSM = Number('{{ widget.data.space_between_sm }}');
    const spaceBetweenMD = Number('{{ widget.data.space_between_md }}');
    const spaceBetweenLG = Number('{{ widget.data.space_between_lg }}');

    const allowTouchMove = '{{ widget.data.allow_touch_move }}' === 'true';
    const grabCursor = '{{ widget.data.grab_cursor }}' === 'true';
    const loop = '{{ widget.data.loop }}' === 'true';
    const speed = Number('{{ widget.data.speed }}');
    const autoplayDelay = Number('{{ widget.data.autoplay_delay }}');

    const swiper = new Swiper(swiperElem, {
      grabCursor,
      speed,
      allowTouchMove,

      autoplay: false,
      loop: true,

      navigation: {
        nextEl: '.swiper-button-next-special',
        prevEl: '.swiper-button-prev-special'
      },

      breakpoints: {
        0: {
          centeredSlides: false,
          slidesPerView: slidesPerViewSM,
          spaceBetween: spaceBetweenSM
        },
        400: {
          centeredSlides: false,
          slidesPerView: slidesPerViewMD,
          spaceBetween: spaceBetweenMD
        },
        768: {
          centeredSlides: false,
          slidesPerView: slidesPerViewMD,
          spaceBetween: spaceBetweenMD
        },
        1000: {
          centeredSlides: false,
          slidesPerView: slidesPerViewLG > 3 ? 3 : slidesPerViewLG,
          spaceBetween: spaceBetweenMD
        },
        1200: {
          centeredSlides: false,
          slidesPerView: slidesPerViewLG,
          spaceBetween: spaceBetweenLG
        }
      },

      on: {
        init() {
          handleSpecialAutoplay(this);
        },
        breakpoint() {
          handleSpecialAutoplay(this);
        }
      }
    });

    function handleSpecialAutoplay(swiperInstance) {
      if (!autoplayEnabled) {
        swiperInstance.autoplay?.stop();
        swiperInstance.loopDestroy?.();
        swiperInstance.params.loop = false;
        return;
      }

      const currentSlidesPerView = Math.ceil(
        swiperInstance.params.slidesPerView
      );

      const shouldAutoplay = slidesCount > currentSlidesPerView;

      if (shouldAutoplay) {
        if (!swiperInstance.params.loop) {
          swiperInstance.params.loop = true;
          swiperInstance.loopCreate();
        }

        swiperInstance.params.autoplay = {
          delay: autoplayDelay,
          disableOnInteraction: false,
          pauseOnMouseEnter: true
        };

        swiperInstance.autoplay.start();
      } else {
        swiperInstance.autoplay.stop();
        swiperInstance.loopDestroy();
        swiperInstance.params.loop = false;
      }
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSpecialSwiper, { once: true });
  } else {
    initSpecialSwiper();
  }
</script>



{% style %}
.swiper-button-next-special, .swiper-button-prev-special {
width: 14px;
height: 27px;
}

.specialSwiper .swiper-slide {
  display: flex;
  height: 100%;
}

.specialSwiper .swiper-slide > .special-card {
  height: 100%;
  min-height: 360px;
}

.specialSwiper .swiper-wrapper {
  align-items: stretch;
}


{% endstyle %}

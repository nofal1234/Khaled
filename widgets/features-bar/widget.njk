{% set use_container = widget.data.use_container %}
{% set bg_color = widget.data.bg_color %}
{% set text_color = widget.data.text_color %}
{% set border_color = widget.data.border_color %}
{% set show_border = widget.data.show_border %}
{% set padding_vh = widget.data.padding_vh %}



<section 
    id="{{widget.id}}" 
    class="w-full  {% if show_border %}border-b{% endif %} "
    style=" background-color: {{ bg_color }}; color: {{ text_color }};padding-top: {{padding_vh}}px;padding-bottom: {{padding_vh}}px;
     {% if show_border %}border-bottom: 1px solid {{ border_color }};{% endif %}"
>
    <div class="{% if use_container %}container mx-auto{% else %}px-2.5{% endif %} h-full">
        <div class="swiper features-bar-swiper" dir="rtl">
            <div class="swiper-wrapper">
                {% for feature in widget.blocks | concat(widget.blocks) %}
                    <div class="swiper-slide">
                        <div class="flex items-center gap-2 sm:gap-2 md:gap-3">
                            <span 
                                class="flex items-center text-sm sm:text-base md:text-lg lg:text-xl flex-shrink-0"
                                style="color: {{ text_color }}"
                            >
                                {{ feature.data.icon | safe }}
                            </span>
                            <span 
                                class="text-xs sm:text-sm md:text-xs lg:text-sm font-bold leading-tight whitespace-nowrap"
                                style="color: {{ text_color }}"
                            >
                                {{ t(feature.data.title) }}
                            </span>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>

<script>
function initFeaturesBarSwiper() {
    const wrapper = document.getElementById(`{{widget.id}}`);
    if (!wrapper || !window.Swiper) return;
    const swiperEl = wrapper.querySelector('.features-bar-swiper');
    if (!swiperEl) return;
    if (swiperEl.swiper) {
        swiperEl.swiper.destroy(true, true);
    }

    const slides = wrapper.querySelectorAll('.swiper-slide').length;

    const loopedSlides = Math.max(Number('{{ widget.data.item_number | default(5) }}'), Math.ceil(slides / 2));
    const sliderSpeed = Number('{{ widget.data.slider_speed }}');
    const sliderDelay = Number('{{ widget.data.slider_delay }}');
    const sliderPauseOnHover = '{{ widget.data.slider_pause_on_hover }}' === 'true';
    const sliderReverseDirection = '{{ widget.data.slider_reverse_direction }}' === 'true';
    const sliderSpaceBetween = Number('{{ widget.data.slider_space_between }}');
    const sliderLoop = '{{ widget.data.slider_loop }}' === 'true';
    const sliderFreeMode = '{{ widget.data.slider_free_mode }}' === 'true';

    new window.Swiper(swiperEl, {
        slidesPerView: 'auto',
        loop: sliderLoop,
        loopedSlides: loopedSlides,
        autoplay: {
            delay: sliderDelay,
            disableOnInteraction: false,
            pauseOnMouseEnter: sliderPauseOnHover,
            reverseDirection: sliderReverseDirection,
        },
        speed: sliderSpeed,
        freeMode: {
            enabled: sliderFreeMode,
            momentum: false,
            sticky: false,
        },
        spaceBetween: sliderSpaceBetween,
        breakpoints: {
            640: {
                spaceBetween: sliderSpaceBetween,
            },
            768: {
                spaceBetween: sliderSpaceBetween,
            },
        }
    });
}

function mountFeaturesBarSwiper(retries) {
    if (window.Swiper) {
        initFeaturesBarSwiper();
        return;
    }
    if (retries > 0) {
        setTimeout(function () {
            mountFeaturesBarSwiper(retries - 1);
        }, 150);
    }
}

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        mountFeaturesBarSwiper(8);
    }, { once: true });
} else {
    mountFeaturesBarSwiper(8);
}
</script>

<style>
.features-bar-swiper {
    overflow: hidden;
    width: 100%;
}

.features-bar-swiper .swiper-wrapper {
    transition-timing-function: linear !important;
    display: flex;
    align-items: center;
}

.features-bar-swiper .swiper-slide {
    width: auto !important;
    flex-shrink: 0;
}
</style>

<!-- Reviews Section -->
<section class="mt-4 md:mt-8 mb-6 md:mb-10 px-2 mx-2.5 md:mx-20">
    <div class="py-4 md:py-8 px-2 md:px-6 rounded-2xl">
        <div class="flex items-center justify-between mb-4 md:mb-6">
            {% set rawSectionTitle = widget.data.title or 'customer_reviews' %}
            <h1 class="text-xl md:text-2xl font-bold text-dark">{{ t(rawSectionTitle) }}</h1>
            <div class="flex items-center gap-2" dir="ltr">
                <div class="swiper-button-prev-reviews cursor-pointer hover:opacity-70 transition hidden md:flex items-center justify-center">
                    <i class="ph ph-caret-left text-black text-lg"></i>
                </div>
                <div class="swiper-button-next-reviews cursor-pointer hover:opacity-70 transition hidden md:flex items-center justify-center">
                    <i class="ph ph-caret-right text-black text-lg"></i>
                </div>
                <a href="#" class="underline text-xs md:text-sm text-black cursor-pointer hover:text-mainColor transition">{{t('view_all')}}</a>
            </div>
        </div>
        
        {% set hasBlocks = widget.blocks and (widget.blocks | length) > 0 %}

        {% set nameKeys = ['review_1_name','review_2_name','review_3_name'] %}
        {% set textKeys = ['review_1_text','review_2_text','review_3_text'] %}
        
        <!-- Desktop Layout -->
        <div class="hidden sm:grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            {% if hasBlocks %}
                {% for block in widget.blocks %}
                {% set idx = loop.index0 % nameKeys|length %}
                {% set nameKey = nameKeys[idx] %}
                {% set textKey = textKeys[idx] %}
                {% set rawName = (block.data and block.data.name) or (block.settings and block.settings.name) or '' %}
                {% set rawText = (block.data and block.data.text) or (block.settings and block.settings.text) or '' %}
                {% set nameKeyToUse = rawName or nameKey %}
                {% set textKeyToUse = rawText or textKey %}
                {% set displayName = t(nameKeyToUse) %}
                {% set displayText = t(textKeyToUse) %}
                {% set rating = (block.settings and block.settings.stars) or (block.data and block.data.stars) or 5 %}
                {% set img = (block.settings and block.settings.image and block.settings.image.fileUrl) or (block.data and block.data.image and block.data.image.fileUrl) %}
                {% set altKey = 'review_image_alt' %}
                <div class="max-w-md mx-auto bg-white rounded-xl border border-gray-200 p-6 w-full">
                    <!-- Header -->
                    <div class="flex justify-between items-start">
                        <!-- User Info (Left) -->
                        <div class="flex items-start gap-3">
                            <!-- Avatar -->
                            {% if img %}
                            <img class="w-10 h-10 rounded-full object-cover flex-shrink-0" src="{{ img }}" alt="{{ t(altKey) }}">
                            {% else %}
                            <img class="w-10 h-10 rounded-full object-cover flex-shrink-0" src="https://i.pravatar.cc/100?u={{ displayName | urlencode }}" alt="{{ t(altKey) }}">
                            {% endif %}
                            <!-- Name and Time -->
                            <div class="text-left">
                                <h3 class="text-xl font-semibold text-gray-900">{{ displayName }}</h3>
                            </div>
                        </div>
                        
                        <!-- Rating Badge (Right) -->
                        <div class="bg-black text-white text-base font-bold rounded-md px-3 py-1.5 flex items-center gap-1">
                            <span>{{ rating }}</span>
                            <span class="text-white">★</span>
                        </div>
                    </div>
                    
                    <!-- Body -->
                    <div class="mt-8">
                        <p class="text-center text-sm text-gray-600 leading-relaxed">{{ displayText | striptags }}</p>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <!-- Defaults when no blocks -->
                {% for idx in range(3) %}
                {% set nameKey = nameKeys[idx] %}
                {% set textKey = textKeys[idx] %}
                <div class="max-w-md mx-auto bg-white rounded-xl border border-gray-200 p-6 w-full">
                    <!-- Header -->
                    <div class="flex justify-between items-start">
                        <!-- User Info (Left) -->
                        <div class="flex items-start gap-3">
                            <!-- Avatar -->
                            <img class="w-10 h-10 rounded-full object-cover flex-shrink-0" src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=100&q=80" alt="{{ t('review_image_alt') }}">
                            <!-- Name and Time -->
                            <div class="text-left">
                                <h3 class="text-xl font-semibold text-gray-900">{{ t(nameKey) }}</h3>
                            </div>
                        </div>
                        
                        <!-- Rating Badge (Right) -->
                        <div class="bg-black text-white text-base font-bold rounded-md px-3 py-1.5 flex items-center gap-1">
                            <span>5.0</span>
                            <span class="text-white">★</span>
                        </div>
                    </div>
                    
                    <!-- Body -->
                    <div class="mt-8">
                        <p class="text-center text-sm text-gray-600 leading-relaxed">{{ t(textKey) }}</p>
                    </div>
                </div>
                {% endfor %}
            {% endif %}
        </div>
        
        <!-- Mobile Layout: Swiper -->
        <div class="sm:hidden relative">
            <div class="swiper reviewsSwiper">
                <div class="swiper-wrapper">
                    {% if hasBlocks %}
                        {% for block in widget.blocks %}
                        {% set idx = loop.index0 % nameKeys|length %}
                        {% set nameKey = nameKeys[idx] %}
                        {% set textKey = textKeys[idx] %}
                        {% set rawName = (block.data and block.data.name) or (block.settings and block.settings.name) or '' %}
                        {% set rawText = (block.data and block.data.text) or (block.settings and block.settings.text) or '' %}
                        {% set nameKeyToUse = rawName or nameKey %}
                        {% set textKeyToUse = rawText or textKey %}
                        {% set displayName = t(nameKeyToUse) %}
                        {% set displayText = t(textKeyToUse) %}
                        {% set rating = (block.settings and block.settings.stars) or (block.data and block.data.stars) or 5 %}
                        {% set img = (block.settings and block.settings.image and block.settings.image.fileUrl) or (block.data and block.data.image and block.data.image.fileUrl) %}
                        {% set altKey = 'review_image_alt' %}
                        <div class="swiper-slide">
                            <div class="max-w-md mx-auto bg-white rounded-xl border border-gray-200 p-6 w-full">
                                <!-- Header -->
                                <div class="flex justify-between items-start">
                                    <!-- User Info (Left) -->
                                    <div class="flex items-start gap-3">
                                        <!-- Avatar -->
                                        {% if img %}
                                        <img class="w-10 h-10 rounded-full object-cover flex-shrink-0" src="{{ img }}" alt="{{ t(altKey) }}">
                                        {% else %}
                                        <img class="w-10 h-10 rounded-full object-cover flex-shrink-0" src="https://i.pravatar.cc/100?u={{ displayName | urlencode }}" alt="{{ t(altKey) }}">
                                        {% endif %}
                                        <!-- Name and Time -->
                                        <div class="text-left">
                                            <h3 class="text-xl font-semibold text-gray-900">{{ displayName }}</h3>
                                        </div>
                                    </div>
                                    
                                    <!-- Rating Badge (Right) -->
                                    <div class="bg-black text-white text-base font-bold rounded-md px-3 py-1.5 flex items-center gap-1">
                                        <span>{{ rating }}</span>
                                        <span class="text-white">★</span>
                                    </div>
                                </div>
                                
                                <!-- Body -->
                                <div class="mt-8">
                                    <p class="text-center text-sm text-gray-600 leading-relaxed">{{ displayText | striptags }}</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <!-- Default reviews for mobile -->
                        {% for idx in range(3) %}
                        {% set nameKey = nameKeys[idx] %}
                        {% set textKey = textKeys[idx] %}
                        <div class="swiper-slide">
                            <div class="max-w-md mx-auto bg-white rounded-xl border border-gray-200 p-6 w-full">
                                <!-- Header -->
                                <div class="flex justify-between items-start">
                                    <!-- User Info (Left) -->
                                    <div class="flex items-start gap-3">
                                        <!-- Avatar -->
                                        <img class="w-10 h-10 rounded-full object-cover flex-shrink-0" src="https://i.pravatar.cc/100?u={{ t(nameKey) | urlencode }}" alt="{{ t('review_image_alt') }}">
                                        <!-- Name and Time -->
                                        <div class="text-left">
                                            <h3 class="text-xl font-semibold text-gray-900">{{ t(nameKey) }}</h3>
                                        </div>
                                    </div>
                                    
                                    <!-- Rating Badge (Right) -->
                                    <div class="bg-black text-white text-base font-bold rounded-md px-3 py-1.5 flex items-center gap-1">
                                        <span>5.0</span>
                                        <span class="text-white">★</span>
                                    </div>
                                </div>
                                
                                <!-- Body -->
                                <div class="mt-8">
                                    <p class="text-center text-sm text-gray-600 leading-relaxed">{{ t(textKey) }}</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Swiper CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

<!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const reviewsSwiperElement = document.querySelector('.reviewsSwiper');
    if (reviewsSwiperElement) {
        const reviewsSwiper = new Swiper('.reviewsSwiper', {
            slidesPerView: 1,
            spaceBetween: 16,
            loop: true,
            grabCursor: true,
            centeredSlides: true,
            navigation: { 
                nextEl: '.swiper-button-next-reviews', 
                prevEl: '.swiper-button-prev-reviews' 
            },
            autoplay: { 
                delay: 4000, 
                disableOnInteraction: false 
            },
            breakpoints: {
                320: { slidesPerView: 1, spaceBetween: 8, centeredSlides: false },
                480: { slidesPerView: 1, spaceBetween: 12, centeredSlides: false },
                640: { slidesPerView: 1, spaceBetween: 16, centeredSlides: false },
            }
        });
    }
});
</script>

<style>
/* Review Card Styling */
.review-card {
    width: 410px;
    height: 235px;
    gap: 26.67px;
    border-radius: 13.33px;
    padding: 13.33px 26.67px;
    border: 1px solid #e5e7eb;
}

.review-name {
    font-family: 'Tajawal', sans-serif;
    font-weight: 500;
    font-size: 16px;
    line-height: 150%;
    letter-spacing: 0.02em;
    flex-shrink: 0;
}

.review-text {
    font-size: 14px;
    line-height: 1.5;
    color: #666;
    flex-grow: 1;
}

/* Review Card Image Styling */
.review-profile-img {
    width: 35px;
    height: 35px;
    opacity: 1;
}


/* Review Card Rating Badge Styling */
.review-rating-badge {
    width: 70px;
    height: 35px;
    gap: 6px;
    border-radius: 6.67px;
    opacity: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0 8px;
}

/* Mobile Reviews Styling */
@media (max-width: 640px) {
    .review-card {
        width: 100% !important;
        max-width: 410px;
    }
    
    .reviewsSwiper {
        overflow: hidden;
    }
    
    .reviewsSwiper .swiper-slide {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100% !important;
    }
    
    .reviewsSwiper .swiper-slide > div {
        max-width: 410px;
        width: 100%;
        margin: 0 auto;
    }
    
    .reviewsSwiper .swiper-slide:not(.swiper-slide-active) {
        opacity: 0;
        transform: scale(0.8);
    }
    
    .reviewsSwiper .swiper-slide-active {
        opacity: 1;
        transform: scale(1);
    }
}
</style>
<section id="product-details" class="bg-white" x-data="xDataproduct({ product: context.product })" x-ref="productComponent">
    <div class="px-2.5 md:px-6 mx-2.5 md:mx-20 pt-6">
        <!-- Breadcrumb -->
        <div class="py-4 mt-2 md:mt-4">
            <nav class="flex items-center gap-2 text-sm text-gray-600">
                <a href="#" class="hover:text-mainColor transition">الرئيسية</a>
                <span>/</span>
                <a href="#" class="hover:text-mainColor transition">أطفال</a>
                <span>/</span>
                <span class="text-mainColor font-semibold">تفاصيل المنتج</span>
            </nav>
        </div>
        <!-- Product Details Section -->
        <section class="py-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12">
                <!-- Product Images -->
                <div class="flex flex-col gap-4" x-data="{ imgSelected: 0 }">
                    <!-- Main Image -->
                    <div class="bg-gray-100 rounded-2xl overflow-hidden">
                        <img :src="context.product?.images?.[imgSelected]?.fileUrl" alt="صورة المنتج" class="w-full object-cover" />
                    </div>

                    <!-- Thumbnail Images -->
                    <div class="grid grid-cols-3 gap-3">
                        <template x-for="(image, index) in context.product?.images || []" :key="index">
                            <div class="bg-gray-100 rounded-lg overflow-hidden cursor-pointer border-2 transition"
                                 :class="imgSelected === index ? 'border-gray-900' : 'border-gray-200 hover:border-mainColor'"
                                 @click="imgSelected = index">
                                <img :src="image.fileUrl" alt="Thumbnail" class="w-64 h-40 object-cover" />
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Product Info -->
                <div class="flex flex-col gap-6">
                    <!-- Title -->
                    <div>
                        <h1 class="text-3xl md:text-4xl font-bold text-dark mb-4" x-text="context.product?.title"></h1>
                    </div>

                    <!-- Description -->
                    <div>
                        <p class="text-gray-600 leading-relaxed" x-text="context.product?.description"></p>
                    </div>

                    <!-- Price -->
                    <div class="flex gap-4 flex-col">
                        <h1 class="text-2xl text-mainColor">السعر</h1>
                        <template x-if="context.product?.pricing?.compareAtPrice && context.product?.pricing?.compareAtPrice > context.product?.pricing?.price">
                            <div class="flex items-center gap-3">
                                <span class="text-4xl font-bold text-mainColor" x-text="context.product?.pricing?.price"></span>
                                <span class="text-mainColor" x-text="globals.app.generalSettings.currency.currencySymbol"></span>
                                <span class="text-lg text-gray-500 line-through" x-text="context.product?.pricing?.compareAtPrice"></span>
                            </div>
                        </template>
                        <template x-if="!context.product?.pricing?.compareAtPrice || context.product?.pricing?.compareAtPrice === context.product?.pricing?.price">
                            <div class="flex items-center gap-2">
                                <span class="text-4xl font-bold text-mainColor" x-text="context.product?.pricing?.price"></span>
                                <span class="text-mainColor" x-text="globals.app.generalSettings.currency.currencySymbol"></span>
                            </div>
                        </template>
                    </div>

                    <!-- Color Selection -->
                    <div>
                        <h3 class="text-xl font-bold mb-3">اللون</h3>
                        <div class="flex items-center gap-3">
                            {% if widget.blocks %}
                                {% for block in widget.blocks %}
                                    {% if block.type == 'colorOption' %}
                                    <button class="relative group">
                                        {% if block.data.image %}
                                            <img src="{{ block.data.image.fileUrl }}" alt="{{ (block.data.name | default(block.settings.name)) | striptags }}" class="w-16 h-16 object-cover rounded-lg border-2 transition border-gray-300 hover:border-mainColor" />
                                        {% else %}
                                            <img src="{{ 'card4.png' | assets }}" alt="{{ (block.data.name | default(block.settings.name)) | striptags }}" class="w-16 h-16 object-cover rounded-lg border-2 transition border-gray-300 hover:border-mainColor" />
                                        {% endif %}
                                    </button>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <!-- Default color options when no blocks are defined -->
                                <button class="relative group">
                                    <img src="{{ 'card4.png' | assets }}" alt="Color Option" class="w-16 h-16 object-cover rounded-lg border-2 transition border-gray-300 hover:border-mainColor" />
                                </button>
                                <button class="relative group">
                                    <img src="{{ 'card5.png' | assets }}" alt="Color Option" class="w-16 h-16 object-cover rounded-lg border-2 transition border-gray-300 hover:border-mainColor" />
                                </button>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Size Selection -->
                    <div>
                        <h3 class="text-2xl text-mainColor mb-3">المقاسات</h3>
                        <div class="flex items-center gap-3 flex-wrap">
                            {% if widget.blocks %}
                                {% for block in widget.blocks %}
                                    {% if block.type == 'sizeOption' %}
                                    <button class="px-6 py-2 bg-[#F7F7F7] text-[#8C8C8C] rounded-full hover:bg-[#D9D9D9] hover:text-[#000000] transition font-bold">{{ block.data.size | default(block.settings.size) | striptags }}</button>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <!-- Default size options when no blocks are defined -->
                                <button class="px-6 py-2 bg-[#F7F7F7] text-[#8C8C8C] rounded-full hover:bg-[#D9D9D9] hover:text-[#000000] transition font-bold">S</button>
                                <button class="px-6 py-2 bg-[#F7F7F7] text-[#8C8C8C] rounded-full hover:bg-[#D9D9D9] hover:text-[#000000] transition font-bold">M</button>
                                <button class="px-6 py-2 bg-[#F7F7F7] text-[#8C8C8C] rounded-full hover:bg-[#D9D9D9] hover:text-[#000000] transition font-bold">L</button>
                                <button class="px-6 py-2 bg-[#F7F7F7] text-[#8C8C8C] rounded-full hover:bg-[#D9D9D9] hover:text-[#000000] transition font-bold">XL</button>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Quantity, Add to Cart, Buy Now -->
                    <form id="productForm" class="flex gap-4 flex-col w-full">
                        <input type="hidden" name="product" :value="context.product?._id">
                        <input type="hidden" name="quantity" :value="productQuantity">
                        <div class="flex items-center gap-3">
                            <div class="flex items-center border border-gray-300" style="width: 124px; height: 57px; border-radius: 33px; border-width: 1px; padding-top: 8px; padding-right: 16px; padding-bottom: 8px; padding-left: 16px; gap: 32px;">
                                <input type="number" min="1" x-model.number="productQuantity" class="qty-input text-center border-0 p-0 focus:ring-0 font-semibold text-gray-800" style="width: 20px;" />
                                <div class="flex flex-col items-center" style="gap: 2px;">
                                    <button type="button" class="text-gray-600 hover:text-gray-800" aria-label="زيادة الكمية" @click="increaseCartItem()">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" />
                                        </svg>
                                    </button>
                                    <button type="button" class="text-gray-600 hover:text-gray-800" aria-label="تقليل الكمية" @click="decreaseCartItem()">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-4 flex-col md:flex-row">
                            <button name="addToCart" type="submit" class="flex-1 bg-black text-white py-4 rounded-full font-bold text-lg items-center justify-center gap-2 hover:scale-105 transition-transform duration-300">إضافة الي العربة</button>
                            <button name="buyNow" type="submit" class="flex-1 px-6 py-4 border-2 border-black rounded-full font-bold text-lg items-center justify-center hover:scale-105 transition-transform duration-300">شراء الان</button>
                        </div>
                    </form>

                    <!-- Additional Info -->
                    <div class="border-t border-gray-200 pt-6 space-y-4">
                        <div class="flex items-center gap-3">
                            <i class="ph-light ph-alarm text-2xl text-mainColor"></i>
                            <div>
                                <p class="font-bold">متبقي ٢٠ قطع فقط في المخزون. اطلبها قريبًا.</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <i class="ph-light ph-check text-2xl text-mainColor"></i>
                            <div>
                                <p class="font-bold">التوصيل والشحن مجاني</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <i class="ph-light ph-check text-2xl text-mainColor"></i>
                            <div>
                                <p class="font-bold">الدفع الآمن عبر الإنترنت</p>
                            </div>
                        </div>
                    </div>

                    <!-- Features 2 Section -->
                    <section>
                        <div>
                            <div class="grid grid-cols-2 sm:grid-cols-2 gap-2 w-full">
                                <div class="flex flex-col items-center text-center p-4 sm:p-5 md:p-6 rounded-2xl border border-gray-200 bg-white hover:shadow-xl transition-all duration-300 hover:-translate-y-2">
                                    <div class="w-24 h-16 rounded-full flex items-center justify-center">
                                        <i class="ph-light ph-star text-mainColor text-xl"></i>
                                    </div>
                                    <h3 class="text-base text-lg text-dark">الشحن العالمي السريع</h3>
                                </div>
                                <div class="flex flex-col items-center text-center p-4 sm:p-5 md:p-6 rounded-2xl border border-gray-200 bg-white hover:shadow-xl transition-all duration-300 hover:-translate-y-2">
                                    <div class="w-24 h-16 rounded-full flex items-center justify-center">
                                        <i class="ph-light ph-star text-mainColor text-xl"></i>
                                    </div>
                                    <h3 class="text-base text-lg text-dark">إرجاع مجاني</h3>
                                </div>
                                <div class="flex flex-col items-center text-center p-4 sm:p-5 md:p-6 rounded-2xl border border-gray-200 bg-white hover:shadow-xl transition-all duration-300 hover:-translate-y-2">
                                    <div class="w-24 h-16 rounded-full flex items-center justify-center">
                                        <i class="ph-light ph-star text-mainColor text-xl"></i>
                                    </div>
                                    <h3 class="text-base text-lg text-dark">مدفوعات آمنة بنسبة 100%</h3>
                                </div>
                                <div class="flex flex-col items-center text-center p-4 sm:p-5 md:p-6 rounded-2xl border border-gray-200 bg-white hover:shadow-xl transition-all duration-300 hover:-translate-y-2">
                                    <div class="w-24 h-16 rounded-full flex items-center justify-center">
                                        <i class="ph-light ph-star text-mainColor text-xl"></i>
                                    </div>
                                    <h3 class="text-base text-lg text-dark">شحن مجاني مع تعويض</h3>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </section>
    </div>
</section>
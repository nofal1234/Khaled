<section id="product-details" class="bg-white" x-data="xDataproduct({ product: context.product })" x-ref="productComponent">
    <div class="px-2.5 md:px-6 mx-2.5 md:mx-20 pt-6">
        <!-- Breadcrumb -->
        <div class="py-4 mt-2 md:mt-4">
            <nav class="flex items-center gap-2 text-sm text-gray-600">
                <a href="/" class="hover:text-mainColor transition">{{ t('home') }}</a>
                <span>/</span>
                <span class="text-mainColor font-semibold">{{ t('product_details') }}</span>
            </nav>
        </div>
        <!-- Product Details Section -->
        <section class="py-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12">
                <!-- Product Images -->
                <div class="flex flex-col gap-4" x-data="{ imgSelected: 0 }">
                    <!-- Main Image -->
                    <div class="bg-gray-100 rounded-2xl overflow-hidden">
                        <img :src="context.product?.images?.[imgSelected]?.fileUrl" alt="صورة المنتج" class="w-full object-cover" />
                    </div>

                    <!-- Thumbnail Images -->
                    <div class="grid grid-cols-3 gap-3">
                        <template x-for="(image, index) in context.product?.images || []" :key="index">
                            <div class="bg-gray-100 rounded-lg overflow-hidden cursor-pointer border-2 transition"
                                 :class="imgSelected === index ? 'border-gray-900' : 'border-gray-200 hover:border-mainColor'"
                                 @click="imgSelected = index">
                                <img :src="image.fileUrl" alt="Thumbnail" class="w-64 h-40 object-cover" />
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Product Info -->
                <div class="flex flex-col gap-3">
                    <!-- Title -->
                    <div>
                        <h1 class="text-3xl md:text-4xl font-bold text-dark mb-1" x-text="context.product?.title"></h1>
                    </div>

                    <!-- Description -->
                    <div>
                        <div
                            class="text-gray-600 leading-relaxed text-sm md:text-base font-cairo product-description text-right"
                            x-html="context.product?.description || 'لا يوجد وصف للمنتج'">
                        </div>
                    </div>

                    <!-- Price -->
                    <div class="flex gap-4 flex-col">
                        <h1 class="text-2xl text-mainColor">{{t('price')}}</h1>
                        <template x-if="context.product?.pricing?.compareAtPrice && context.product?.pricing?.compareAtPrice > context.product?.pricing?.price">
                            <div class="flex items-center gap-3">
                                <span class="text-4xl font-bold text-mainColor" x-text="context.product?.pricing?.price"></span>
                                <span class="text-mainColor">{{ globals.app.generalSettings.currency.currencySymbol }}</span>
                                <span class="text-lg text-gray-500 line-through" x-text="context.product?.pricing?.compareAtPrice"></span>
                                <span class="text-mainColor">{{ globals.app.generalSettings.currency.currencySymbol }}</span>
                            </div>
                        </template>
                        <template x-if="!context.product?.pricing?.compareAtPrice || context.product?.pricing?.compareAtPrice === context.product?.pricing?.price">
                            <div class="flex items-center gap-2">
                                <span class="text-4xl font-bold text-mainColor" x-text="context.product?.pricing?.price"></span>
                                <span class="text-mainColor">{{ globals.app.generalSettings.currency.currencySymbol }}</span>
                            </div>
                        </template>
                    </div>

                    <!-- Dynamic Product Options from context.product.options -->
                    <div x-init="initOptions()" class="mb-2" x-show="context.product?.options?.length > 0">
                        <template x-for="opt in context.product.options" :key="opt._id">
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 font-cairo mb-2" x-text="opt.name"></label>
                                <div class="flex flex-wrap gap-2">
                                    <template x-for="val in opt.values" :key="val._id">
                                        <button type="button"
                                            class="px-4 py-2 rounded-lg border-2 transition-all duration-200 font-cairo text-sm flex items-center gap-2"
                                            :class="selectedOptions[opt._id] === val._id
                                                ? 'border-gray-900 bg-gray-900 text-white'
                                                : 'border-gray-200 text-gray-700 hover:border-gray-300 hover:bg-gray-50'"
                                            @click.prevent="selectOption(context.product,opt._id, val._id)">
                                            <span x-text="val.label"></span>
                                        </button>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- Quantity, Add to Cart, Buy Now -->
                    <form id="productForm" class="flex flex-col w-full gap-4" @submit="submitForm">
                        <input type="hidden" name="product" :value="context.product?._id">
                        <input type="hidden" name="quantity" :value="productQuantity">
                        <template x-for="opt in context.product.options" :key="opt._id">
                            <input type="hidden" name="options[]" :value="selectedOptions[opt._id]">
                        </template>

                        <!-- Row: Quantity on one side + add to cart on the other -->
                        <div class="flex items-center gap-3 w-full">
                            <!-- Restored original quantity styling -->
                            <div class="flex items-center border border-gray-300" style="width: 124px; height: 57px; border-radius: 33px; border-width: 1px; padding-top: 8px; padding-right: 16px; padding-bottom: 8px; padding-left: 16px; gap: 32px;">
                                <input type="number" min="1" x-model.number="productQuantity" class="qty-input text-center border-0 p-0 focus:ring-0 font-semibold text-gray-800" style="width: 20px;" />
                                <div class="flex flex-col items-center" style="gap: 2px;">
                                    <button type="button" class="text-gray-600 hover:text-gray-800" aria-label="{{ t('increase_quantity') }}" @click="increaseCartItem()">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" />
                                        </svg>
                                    </button>
                                    <button type="button" class="text-gray-600 hover:text-gray-800" aria-label="{{ t('decrease_quantity') }}" @click="decreaseCartItem()">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- Primary add to cart button takes remaining width -->
                            <button
                                name="addToCart"
                                type="submit"
                                class="flex-1 bg-black text-white py-4 rounded-full font-bold text-lg flex items-center justify-center gap-2 hover:scale-105 transition-transform duration-300">
                                {{ t('add_to_cart') }}
                            </button>
                        </div>

                        <!-- Full width buy now button under them -->
                        <button
                            name="buyNow"
                            type="submit"
                            class="w-full px-6 py-4 border-2 border-black rounded-full font-bold text-lg flex items-center justify-center hover:scale-105 transition-transform duration-300">
                            {{ t('buy_now') }}
                        </button>
                    </form>

                    <!-- Additional Info -->
                    <div class="border-t border-gray-200 pt-6 space-y-4">
                        <div class="flex items-center gap-3">
                            <i class="ph-light ph-alarm text-2xl text-mainColor"></i>
                            <div>
                                <p class="font-bold">{{ t('stock_remaining').replace('{count}', '20') }}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <i class="ph-light ph-check text-2xl text-mainColor"></i>
                            <div>
                                <p class="font-bold">{{ t('free_shipping') }}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <i class="ph-light ph-check text-2xl text-mainColor"></i>
                            <div>
                                <p class="font-bold">{{ t('secure_payment') }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Features 2 Section -->
                    <section>
                        <div>
                            <div class="grid grid-cols-2 sm:grid-cols-2 gap-2 w-full">
                                <div class="flex flex-col items-center text-center p-4 sm:p-5 md:p-6 rounded-2xl border border-gray-200 bg-white hover:shadow-xl transition-all duration-300 hover:-translate-y-2">
                                    <div class="w-24 h-16 rounded-full flex items-center justify-center">
                                        <i class="ph-light ph-star text-mainColor text-xl"></i>
                                    </div>
                                    <h3 class="text-base text-lg text-dark">{{ t('fast_global_shipping') }}</h3>
                                </div>
                                <div class="flex flex-col items-center text-center p-4 sm:p-5 md:p-6 rounded-2xl border border-gray-200 bg-white hover:shadow-xl transition-all duration-300 hover:-translate-y-2">
                                    <div class="w-24 h-16 rounded-full flex items-center justify-center">
                                        <i class="ph-light ph-star text-mainColor text-xl"></i>
                                    </div>
                                    <h3 class="text-base text-lg text-dark">{{ t('free_returns') }}</h3>
                                </div>
                                <div class="flex flex-col items-center text-center p-4 sm:p-5 md:p-6 rounded-2xl border border-gray-200 bg-white hover:shadow-xl transition-all duration-300 hover:-translate-y-2">
                                    <div class="w-24 h-16 rounded-full flex items-center justify-center">
                                        <i class="ph-light ph-star text-mainColor text-xl"></i>
                                    </div>
                                    <h3 class="text-base text-lg text-dark">{{ t('secure_payments_100') }}</h3>
                                </div>
                                <div class="flex flex-col items-center text-center p-4 sm:p-5 md:p-6 rounded-2xl border border-gray-200 bg-white hover:shadow-xl transition-all duration-300 hover:-translate-y-2">
                                    <div class="w-24 h-16 rounded-full flex items-center justify-center">
                                        <i class="ph-light ph-star text-mainColor text-xl"></i>
                                    </div>
                                    <h3 class="text-base text-lg text-dark">{{ t('free_shipping_compensation') }}</h3>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </section>
    </div>
</section>
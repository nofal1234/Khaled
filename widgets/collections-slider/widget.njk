{% set section_title = widget.data.section_title %}
{% set view_all_link = widget.data.view_all_link %}
{% set show_view_all = widget.data.show_view_all %}
{% set title_color = widget.data.title_color  %}
{% set link_color = widget.data.link_color %}
{% set card_border_color = widget.data.card_border_color %}
{% set card_hover_color = widget.data.card_hover_color  %}
{% set show_navigation = widget.data.show_navigation  %}
{% set show_border = widget.data.show_border %}

<section class="mt-4 md:mt-8 mb-3 md:mb-5 container">
  <div class="flex flex-col md:gap-6 gap-4 py-4">
    <div class="flex items-center justify-between mb-4 md:mb-6">
      <h1 class="md:text-[40px] text-lg md:leading-[120%] leading-[150%] font-bold" style="color: {{ title_color }};">{{ t(widget.data.section_title or 'collections') }}</h1>
      <div class="flex items-center gap-4">
        {% if show_view_all %}
          <a href="{{ view_all_link }}"
            class="underline text-xs md:text-sm cursor-pointer transition py-0 px-0 md:py-2 md:px-3"
            style="color: {{ link_color }};">
            {{ t('view_all') }}
          </a>
        {% endif %}

        {% if show_navigation %}
          <div class="flex items-center gap-[38px]" >
            <div class="cursor-pointer  swiper-button-next-category  hidden md:flex items-center justify-center bg-transparent">
              <i class="ph  ph-caret-right text-lg" style="color: {{ link_color }};"></i>
            </div>
            <div class=" swiper-button-prev-category cursor-pointer hidden md:flex items-center justify-center bg-transparent">
              <i class="ph  ph-caret-left text-lg" style="color: {{ link_color }};"></i>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
    {% set selected_collections = widget.data.collections or [] %}
    {% if selected_collections | length > 0 %}
    <div class="relative">
      <div id="category-swiper-{{ widget.id }}" class="swiper categorySwiper">
        <div class="swiper-wrapper">
          {% if selected_collections |length == 0 %}
            {% for item in [1,2,3,4,5,6] %}
              
          <div class="swiper-slide">
              <div class="flex flex-col md:gap-6 gap-2 items-center cursor-not-allowed opacity-60">
                <div class="group w-24 h-24 md:w-[159px] md:h-[159px] rounded-full overflow-hidden {%if show_border %} border {%endif%} flex items-center justify-center bg-gray-100"
                  style="border-color: {{ card_border_color }};">
                  <span class="text-4xl text-gray-300">
                    <i class="ph ph-image"></i>
                  </span>
                </div>
                <span class="text-xs md:text-xl md:font-medium text-center text-gray-400" style="color: {{ collection_title_color }};">{{ t('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª') }}</span>
              </div>
            </div>
            {% endfor %}
            {% else %}
            {% for item in selected_collections %}
            <div class="swiper-slide">
              <a href="collection/{{item.handle }}"
                class="flex flex-col md:gap-6 gap-2 items-center cursor-pointer no-underline">
                <div
                  class="group w-[80px] h-[80px]  md:w-[159px] md:h-[159px] rounded-full overflow-hidden {%if show_border %} border {%endif%}"
                    style="border-color: {{ card_border_color }};"
                    onmouseover="this.style.borderColor='{{ card_hover_color }}';"
                    onmouseout="this.style.borderColor='{{ card_border_color }}';"
                >
                  <img src="{{ item.image.fileUrl }}" alt="{{item.title}}"
                    class="group-hover:scale-105 transition-all duration-300 w-[80px] h-[80px] md:w-[159px] md:h-[159px] rounded-full object-cover ">
                </div>
                <span class="text-xs md:text-xl md:font-medium text-center" style="color: {{ collection_title_color }};">{{  item.title}}</span>
              </a>
            </div>
            {% endfor %}
          {% endif %}
        </div>
      </div>
  </div>
    {% else  %}
{% ui "empty.njk" %}
      
    {% endif %}

  </div>


</section>
<script>
  function getSlidesPerViewByWidth(width) {
    if (width >= 1200) return Number('{{ widget.data.slides_per_view_lg }}');
    if (width >= 1000) return Number('{{ widget.data.slides_per_view_md }}');
    if (width >= 768)  return Number('{{ widget.data.slides_per_view_sm }}');
    return Number('{{ widget.data.slides_per_view_sm }}');
  }

  function initCategorySwiper() {
    var swiperElem = document.getElementById('category-swiper-{{ widget.id }}');
    if (!swiperElem || !window.Swiper) return;

    if (swiperElem.swiper) {
      swiperElem.swiper.destroy(true, true);
    }

    const selectedCollectionsCount = {{ selected_collections | length }};
    const autoplayEnabled = '{{ widget.data.autoplay }}' === 'true';

    const slidesPerViewSM = Number('{{ widget.data.slides_per_view_sm }}');
    const spaceBetweenSM = Number('{{ widget.data.space_between_sm }}');
    const slidesPerViewMD = Number('{{ widget.data.slides_per_view_md }}');
    const spaceBetweenMD = Number('{{ widget.data.space_between_md }}');
    const slidesPerViewLG = Number('{{ widget.data.slides_per_view_lg }}');
    const spaceBetweenLG = Number('{{ widget.data.space_between_lg }}');

    const allowTouchMove = '{{ widget.data.allow_touch_move }}' === 'true';
    const speed = Number('{{ widget.data.speed }}');
    const grabCursor = '{{ widget.data.grab_cursor }}' === 'true';
    const autoplayDelay = Number('{{ widget.data.autoplay_delay }}');

    // ðŸ”¥ Ø­Ø³Ø§Ø¨ autoplay Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒ Ø­Ø³Ø¨ Ø­Ø¬Ù… Ø§Ù„Ø´Ø§Ø´Ø©
    const currentSlidesPerView = getSlidesPerViewByWidth(window.innerWidth);
    const shouldAutoplay =
      autoplayEnabled && selectedCollectionsCount > currentSlidesPerView;

    new window.Swiper('#category-swiper-{{ widget.id }}', {
      loop: shouldAutoplay, // Ù…Ù†Ø·Ù‚ÙŠ Ø¬Ø¯Ù‹Ø§
      grabCursor: grabCursor,
      speed: speed,
      allowTouchMove: allowTouchMove,
      spaceBetween: spaceBetweenSM,

      autoplay: shouldAutoplay
        ? {
            delay: autoplayDelay,
            disableOnInteraction: false,
            pauseOnMouseEnter: true,
            reverseDirection: true
          }
        : false,

      navigation: {
        nextEl: '.swiper-button-next-category',
        prevEl: '.swiper-button-prev-category'
      },

      breakpoints: {
        250: {
          slidesPerView: slidesPerViewSM,
          spaceBetween: spaceBetweenSM
        },
        768: {
          slidesPerView: slidesPerViewSM,
          spaceBetween: spaceBetweenMD
        },
        1000: {
          slidesPerView: slidesPerViewMD,
          spaceBetween: spaceBetweenMD
        },
        1200: {
          slidesPerView: slidesPerViewLG,
          spaceBetween: spaceBetweenLG
        }
      }
    });
  }

  function mountCategorySwiper(retries) {
    if (window.Swiper) {
      initCategorySwiper();
      return;
    }
    if (retries > 0) {
      setTimeout(function () {
        mountCategorySwiper(retries - 1);
      }, 150);
    }
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function () {
      mountCategorySwiper(8);
    }, { once: true });
  } else {
    mountCategorySwiper(8);
  }
</script>


{% style %}
.swiper-button-next-category, .swiper-button-prev-category {
  width: 14px;
  height: 27px;
}
{% endstyle %}

{%  set text_color = widget.data.text_color%}
<section class="py-4 md:py-[37px] max-sm:!max-w-[100%] m-auto sm:container " x-data="xDataCart()">
  <!-- Page Title -->
  <div x-show="globals?.cart?.items?.length > 0" class="flex flex-col gap-4">
    <h1 class="text-xl md:text-2xl lg:text-[40px] max-sm:px-4 leading-[120%] tracking-[2%] font-bold" style="color: {{text_color}};" 
      x-show="globals?.cart?.items?.length > 0">
      {{ t(widget.data.cart_title or 'cart_title') }}
    </h1>

    <div class="grid md:grid-cols-9 gap-3  relative">
      <div class="max-md:hidden md:col-span-6  md:sticky md:top-36  flex  self-start">
        <table class=" w-full ">
          <thead>
            <tr class="">
              <th style="color: {{text_color}};" class="pb-2 font-medium">المنتج</th>
              <th style="color: {{text_color}};" class="pb-2 font-medium">السعر</th>
              <th style="color: {{text_color}};" class="pb-2 font-medium">الكمية</th>
              <th style="color: {{text_color}};" class="pb-2 text-start font-medium">المجموع الكلي</th>
            </tr>
          </thead>
          <tbody>
            <template x-for="item in globals?.cart?.items" :key="item._id">
              <tr class="border-t py-2">
                <td class="pt-2 p-0 h-full flex items-center gap-4" style="color: {{text_color}};">
                  <div class="flex items-center gap-2">
                    <button @click="clearCartItem(item._id)">
                      <i class="ph text-textDescription ph-trash"></i>
                    </button>
                    <div class="bg-bgItem rounded-lg">
                      <img :src="item.productData.image.fileUrl" :alt="item.productData.title"
                        class="w-[103px] h-[87px] object-contain" />
                    </div>
                  </div>
                  <div class="flex flex-col gap-2 justify-center" style="height: -webkit-fill-available; color: {{text_color}};">
                    <span class="text-sm font-medium leading-[150%]" x-text="item.productData.title" style="color: {{text_color}};"></span>
                    <template x-for="option in item.variantData.options" :key="option.label">
                      <span class="leading-[150%]" x-text="option.label" style="color: {{text_color}};"></span>
                    </template>
                  </div>
                </td>
                <td class="pt-2 p-0 font-medium text-base" x-text="money(item.price)" style="color: {{text_color}};"></td>
                <td class="pt-2 p-0">
                  <div
                  style="border-color: {{text_color}};"
                    class="flex w-[98px] h-[45px] items-center border  justify-between px-[22px] rounded-full">
                    <div>
                      <input type="number" :value="item.quantity" min="1"
                        class="qty-input max-w-8 text-center border-0 p-0 focus:ring-0 font-medium"
                        style="color: {{text_color}};"
                        @change="updateCartItemQuantity(item._id, $event.target.value)" />
                    </div>
                    <div class="flex flex-col items-center justify-between">
                      <button @click="increaseCartItem(item._id, item.quantity)"
                  style="color: {{text_color}};"
                        class=" hover:text-gray-800" aria-label="زيادة الكمية">
                        <i class="ph text-sm ph-caret-up"></i>
                      </button>
                      <button @click="decreaseCartItem(item._id, item.quantity)"
                  style="color: {{text_color}};"
                  class=" hover:text-gray-800" aria-label="تقليل الكمية">
                        <i class="ph text-sm ph-caret-down"></i>
                      </button>
                    </div>
                  </div>
                </td>
                <td class="pt-2 p-0">
                  <div class="font-bold" style="color: {{text_color}};"
                    x-text="'€' + parseFloat(item.price * item.quantity).toFixed(2)"></div>
                </td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>

      <div class="max-sm:px-4 md:hidden">
        <table class=" w-full ">
          <thead>
            <tr class="">
              <th class="pb-2 text-start text-sm leading-[150%] font-medium" style="color: {{text_color}};">المنتج</th>
              <th class="pb-2 text-end text-sm leading-[150%] font-medium" style="color: {{text_color}};">السعر</th>
            </tr>
          </thead>
          <tbody>
            <template x-for="item in globals?.cart?.items" :key="item._id">
              <tr class="border-t py-2">
                <td class="pt-2 p-0 h-full flex items-center gap-4" style="color: {{text_color}};">
                  <div class="flex items-center gap-2">
                    <div class="bg-bgItem rounded-lg">
                      <img :src="item.productData.image.fileUrl" :alt="item.productData.title"
                        class="w-[69px] h-[92px] object-contain" />
                    </div>
                    <div class="flex flex-col gap-2" style="color: {{text_color}};">
                      <span class="md:text-sm text-xs font-medium leading-[150%]"
                        x-text="item.productData.title" style="color: {{text_color}};"></span>
                      <template x-for="option in item.variantData.options" :key="option.label">
                        <span class="leading-[150%] text-xs" x-text="option.label" style="color: {{text_color}};"></span>
                      </template>
                      <div
                        class="flex w-[97px] h-[27px] items-center border border-mainColor justify-between px-[22px] rounded-full">
                        <div>
                          <input type="number" :value="item.quantity" min="1"
                            class="qty-input max-w-8 text-center border-0 p-0 focus:ring-0 font-medium"
                            style="color: {{text_color}};"
                            @change="updateCartItemQuantity(item._id, $event.target.value)" />
                        </div>
                        <div class="flex flex-col gap-1.5 items-center justify-between">
                          <button @click="increaseCartItem(item._id, item.quantity)"
                            class="text-gray-600 hover:text-gray-800" aria-label="زيادة الكمية">
                            <svg width="12" height="6" viewBox="0 0 12 6" fill="none"
                              xmlns="http://www.w3.org/2000/svg">
                              <path
                                d="M3.2854 4.5L5.99731 1.78809L6.13403 1.9248L8.71021 4.5L8.96606 4.24316L6.21509 1.49121L6.21411 1.49023C6.18588 1.46188 6.15241 1.43921 6.11548 1.42383C6.07842 1.40841 6.03843 1.40039 5.99829 1.40039C5.95818 1.4004 5.91814 1.40842 5.8811 1.42383C5.84419 1.43922 5.81068 1.46188 5.78247 1.49023L5.78149 1.49121L3.02856 4.24316L3.2854 4.5Z"
                                fill="black" stroke="black" stroke-width="0.387097" />
                            </svg>
                          </button>
                          <button @click="decreaseCartItem(item._id, item.quantity)"
                            class="text-gray-600 hover:text-gray-800" aria-label="تقليل الكمية">
                            <svg width="12" height="6" viewBox="0 0 12 6" fill="none"
                              xmlns="http://www.w3.org/2000/svg">
                              <path
                                d="M8.71484 1.49609L6.00293 4.20801L5.86621 4.07129L3.29004 1.49609L3.03418 1.75293L5.78516 4.50488L5.78613 4.50586C5.81436 4.53421 5.84783 4.55688 5.88477 4.57227C5.92183 4.58769 5.96181 4.5957 6.00195 4.5957C6.04207 4.59569 6.0821 4.58768 6.11914 4.57227C6.15606 4.55687 6.18956 4.53422 6.21777 4.50586L6.21875 4.50488L8.97168 1.75293L8.71484 1.49609Z"
                                fill="black" stroke="black" stroke-width="0.387097" />
                            </svg>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="pt-2 p-0 align-top">
                  <div class="flex flex-col justify-between items-end min-h-[97px]" style="color: {{text_color}};">
                    <span x-text="money(item.price)" style="color: {{text_color}};"></span>
                    <button @click="clearCartItem(item._id)">
                      <i class="ph text-textDescription ph-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>

      <div class="md:col-span-3" x-show="(globals?.cart?.items || []).length > 0">
        <div class="bg-bgItem flex flex-col gap-4  md:rounded-2xl py-2 px-4">
          <div class="flex items-center px-[13px] gap-1" style="color: {{text_color}};">
            <i class="ph ph-package md:text-2xl text-xl" style="color: {{text_color}};"></i>
            <p class="p-2.5 md:text-base text-xs leading-[150%]" style="color: {{text_color}};">{{ t('free_shipping_compensation') }}</p>
          </div>
          <div class="flex flex-col gap-3">
            <div class="flex items-center justify-between cart-summary-row">
              <span class="md:text-base text-sm leading-[150%]" style="color: {{text_color}};">{{ t('price') }}</span>
              <span class="md:text-base text-sm font-medium" style="letter-spacing: 2%; color: {{text_color}};"><span
                  x-text="globals?.cart?.totalPrice || 0"></span> <span
                  x-text="globals?.currency?.currencySymbol"></span></span>
            </div>
            <div class="flex items-center justify-between cart-summary-row">
              <span class="md:text-base text-sm leading-[150%]" style="color: {{text_color}};">{{ t('discount') }}</span>
              <span class="text-error md:text-base text-sm font-medium"><span
                  x-text="globals?.cart?.totalSavings || 0"></span> <span
                  x-text="globals?.currency?.currencySymbol"></span></span>
            </div>
            <div class="flex items-center justify-between cart-summary-row">
              <span class="md:text-base text-sm" style="color: {{text_color}};">{{ t('tax') }}</span>
              <span class="md:text-base text-sm font-medium" style="color: {{text_color}};"><span
                  x-text="globals?.cart?.shippingPrice || 0"></span> <span
                  x-text="globals?.currency?.currencySymbol"></span></span>
            </div>
            <div class="flex items-center justify-between cart-summary-row">
              <span class="md:text-xl font-bold" style="color: {{text_color}};">{{ t(widget.data.cart_total or 'cart_total') }}</span>
              <span class="md:text-2xl text-lg font-bold" style="color: {{text_color}};"><span
                  x-text="globals?.cart?.totalPrice || 0"></span>
                <span x-text="globals?.currency?.currencySymbol"></span></span>
            </div>
          </div>
          <div>
            <label for="orderNotes" class="block leading-[150%] font-medium" style="color: {{text_color}};">{{ t('notes') }}</label>
            <textarea id="orderNotes" rows="4" placeholder="{{ t('add_order_notes') }}..."
              class="w-full px-4 py-2.5 border-2 bg-bgItem outline-none border-stork rounded-lg resize-none text-sm" style="color: {{text_color}};"></textarea>
          </div>
          <div class="flex items-center gap-3">
            <input type="checkbox" id="terms"
              class="w-4 h-4 border-mainColor rounded focus:ring-mainColor" style="color: {{text_color}};" />
            <label for="terms" class="leading-[150%]" style="color: {{text_color}};">
              {{ t('agree_to_terms') }}
            </label>
          </div>
          <button
            class="bg-mainColor max-h-[48px] text-white font-bold md:pt-[15.5px] pt-[13px] md:pb-[5.5px] pb-[4.69px] rounded-full border border-mainColor transition opacity-100 max-w-full"
            @click="checkout()">
            <span class="font-medium text-[15.52px] md:text-lg leading-[150%] text-center">{{
              t(widget.data.cart_checkout_now or 'cart_checkout_now')}}</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div x-show="!globals?.cart || !globals?.cart?.items || globals?.cart?.items?.length === 0">
    <div class="flex flex-col w-full items-center justify-center gap-4">
      <i class="ph ma:text-[110px] text-[150px] ph-shopping-cart" style="color: {{text_color}};"></i>
      <span class="text-2xl font-bold leading-[140%]" style="color: {{text_color}};">{{t("emptycart")}}</span>
    </div>
  </div>
</section>
{% set wishlist_main_color = settings.wishlist_main_color | default('#000') %}
{% set wishlist_background_color = settings.wishlist_background_color | default('#ffffff') %}
{% set wishlist_add_button_bg = settings.wishlist_add_button_bg | default('#003033') %}
{% set wishlist_add_button_text_color = settings.wishlist_add_button_text_color | default('#ffffff') %}
{% set wishlist_image_size = settings.wishlist_image_size | default(120) %}

<div x-data="xDataWishlist()" x-cloak x-show="modal.open && modal.type === 'wishlist'"
class="fixed inset-0 z-50">
<!-- Overlay -->
  <div @click="toggleModal('wishlist')" x-show="modal.open && modal.type === 'wishlist'"
    x-transition:enter="transition-opacity ease-out duration-300" x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100" x-transition:leave="transition-opacity ease-in duration-300"
    x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
    class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>

  <!-- Side Menu Panel -->
  <div class="absolute top-0 right-0 bg-white  w-11/12  lg:w-4/12 md:w-6/12 h-full flex flex-col"
    x-show="modal.open && modal.type === 'wishlist'" x-transition:enter="transition ease-in-out duration-300 transform"
    x-transition:enter-start="translate-x-full" x-transition:enter-end="translate-x-0"
    x-transition:leave="transition ease-in-out duration-300 transform" x-transition:leave-start="translate-x-0"
    x-transition:leave-end="translate-x-full">

    <!-- Header -->
    <div class="flex items-center justify-between px-5 py-4 border-b border-gray-100">
      <div class="flex items-center gap-3">
        <div class="h-9 w-9 rounded-full flex items-center justify-center" style="background-color: {{ wishlist_main_color }}1a; color: {{ wishlist_main_color }};">
          <i class="ph ph-heart text-xl"></i>
        </div>
        <div class="flex flex-col">
          <span class="font-tajawal font-semibold text-base text-gray-900">{{ t('wishlist') }}</span>
          <span class="text-xs text-gray-500" x-text="count() ? count() + ' ' + '{{ t('wishlist_count_suffix') }}' : '{{ t('wishlist_empty_initial') }}'"></span>
        </div>
      </div>
      <button @click="toggleModal('wishlist', false)" class="p-2 rounded-full hover:bg-gray-100 text-gray-500">
        <i class="ph ph-x text-lg"></i>
      </button>
    </div>

    <!-- Content -->
    <div class="flex-1 overflow-y-auto px-4 sm:px-4 py-3 sm:py-4  bg-gray-50/60">
      <!-- Empty State -->
      <template x-if="!items || !items.length">
        <div class="h-full flex flex-col items-center justify-center text-center text-gray-500 gap-3 py-10">
          <div class="h-16 w-16 rounded-full flex items-center justify-center bg-white border border-gray-100 text-gray-400">
            <i class="ph ph-heart text-2xl"></i>
          </div>
          <div class="space-y-1">
            <p class="font-tajawal font-semibold text-sm text-gray-800">{{ t('wishlist_empty_title') }}</p>
            <p class="text-xs text-gray-500">{{ t('wishlist_empty_desc') }}</p>
          </div>
        </div>
      </template>

      <!-- Items List -->
      <template x-if="items && items.length">
        <div class="flex flex-col gap-3">
          <template x-for="it in items" :key="it._id">
            <div class="bg-white rounded-2xl border border-gray-100  p-3 flex gap-3 sm:gap-4">
              <!-- Image -->
              <div class="flex-shrink-0 rounded-xl overflow-hidden bg-gray-100 flex items-center justify-center"
                style="width: {{ wishlist_image_size }}px; height: {{ wishlist_image_size }}px;">
                <template x-if="it.image && it.image.fileUrl">
                  <img :src="it.image.fileUrl" :alt="it.title" class="w-full h-full object-cover" loading="lazy" />
                </template>
                <template x-if="!it.image || !it.image.fileUrl">
                  <i class="ph ph-image text-gray-300 text-2xl"></i>
                </template>
              </div>

              <!-- Info -->
              <div class="flex-1 flex flex-col justify-between min-w-0">
                <div class="space-y-1">
                  <!-- العنوان + زر الحذف -->
                  <div class="flex items-center justify-between gap-2">
                    <p class="font-tajawal font-medium text-[15px] md:text-sm line-clamp-2 min-w-0"
                       x-text="it.title"
                       style="color: {{ wishlist_main_color }}"
                    ></p>
                    <button @click="remove(it._id)" class="p-2.5 rounded-full text-gray-400 hover:text-red-500 flex items-center justify-center">
                      <i class="ph ph-trash text-lg"></i>
                    </button>
                  </div>

                  <!-- السعر + الكمية + الزر تحت العنوان -->
                  <div class="mt-1 flex items-center justify-between gap-3 flex-wrap">
                    <div class="flex items-center gap-2 text-[13px] flex-shrink-0">
                      <span class="font-semibold"
                            x-text="(it.price ?? it.finalPrice ?? 0) + ' ' + currency(it)"
                            style="color: {{ wishlist_main_color }}"
                      ></span>
                      <template x-if="it.compareAtPrice && it.compareAtPrice > (it.price ?? it.finalPrice ?? 0)">
                        <span class="text-[11px] text-gray-400 line-through" x-text="it.compareAtPrice + ' ' + currency(it)"></span>
                      </template>
                    </div>

                    <div class="flex items-center w-full gap-2 wishlist-controls flex-wrap justify-end">
                      <div class="flex items-center border border-gray-300 rounded-full py-0.5 px-2 bg-white">
                        <input
                          type="number"
                          min="1"
                          value="1"
                          class="w-8 text-center text-[11px] border-0 p-0 focus:ring-0 focus:outline-none font-semibold text-gray-800"
                        />
                        <div class="flex flex-col items-center ml-1">
                          <button type="button" class="text-gray-600 hover:text-gray-800" aria-label="{{ t('cart_increase_quantity') }}" @click.prevent="const inp = $el.closest('.wishlist-controls').querySelector('input[type=number]'); if(inp){ inp.value = (Number(inp.value)||1) + 1; }">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-3 h-3">
                              <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" />
                            </svg>
                          </button>
                          <button type="button" class="text-gray-600 hover:text-gray-800 mt-0.5" aria-label="{{ t('cart_decrease_quantity') }}" @click.prevent="const inp = $el.closest('.wishlist-controls').querySelector('input[type=number]'); if(inp){ const v = (Number(inp.value)||1) - 1; inp.value = v > 0 ? v : 1; }">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-3 h-3">
                              <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                            </svg>
                          </button>
                        </div>
                      </div>

                      <button
                        @click="addToCart(it, (function(){ const inp = $el.closest('.wishlist-controls').querySelector('input[type=number]'); return inp ? inp.value : 1; })())"
                        :disabled="loadingId === it._id"
                        class="px-4 py-2 rounded-full text-xs font-medium flex items-center gap-2 hover:opacity-90 disabled:opacity-60 disabled:cursor-not-allowed"
                        style="background-color: {{ wishlist_add_button_bg }}; color: {{ wishlist_add_button_text_color }};"
                      >
                        <span x-show="loadingId !== it._id">{{ t('wishlist_add_to_cart') }}</span>
                        <span x-show="loadingId === it._id" class="flex items-center gap-1">
                          <svg class="animate-spin h-3.5 w-3.5 text-white" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4l3-3-3-3v4a10 10 0 00-10 10h4z"></path>
                          </svg>
                          <span>{{ t('wishlist_adding') }}</span>
                        </span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </template>
        </div>
      </template>
    </div>

    <!-- Footer -->
    <div class="px-4 py-3 w-full border-t bg-white flex items-center justify-between">
      <button @click="clear()" x-show="items && items.length" class="text-[13px] font-medium text-red-500 hover:text-red-600 flex items-center gap-1.5">
        <i class="ph ph-trash-simple text-base"></i>
        <span>{{ t('wishlist_clear') }}</span>
      </button>
      <button @click="toggleModal('wishlist', false)" class=" text-xs font-medium text-mainColor hover:text-dark">{{ t('wishlist_close') }}</button>
    </div>
  </div>
</div>

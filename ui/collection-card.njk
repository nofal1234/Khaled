{% set collection = collection or data.collection %}
{% set collection_uid = collection._id or collection.slug %}
{% set mobile_title_size = (title_size * 0.9) | round(1, 'floor') %}

<a style="background-color: {{ data.bg_container }}; border-radius: {{  '8' if card_border_radius else '0' }}px;"
    href="/collection/{{ collection.slug }}"
    class="h-full bg-white rounded-lg border border-gray overflow-hidden flex flex-col ">
    <div class="relative group overflow-hidden flex items-center justify-center pt-[34px] md:pt-[56px] md:pb-[42px]  pb-[26px] px-[47px]  md:px-[57px]" style="background-color: {{ bg_image }}; 
    border-top-left-radius: {{ card_border_radius }}px; 
    border-top-right-radius: {{  '8' if card_border_radius else '0' }}px;
    ">
        <div class="w-full flex items-center justify-center  ">
            <img src="{{ collection.image.fileUrl | default('https://placehold.co/320x420/eeeeee/666?text=No+Image') }}"
                class="object-contain"
                style="width: {{ image_size * 0.7 }}px; height: {{ image_size  }}px; border-radius: {{ '50%' if is_image_radius else '0' }};"
                alt="{{ collection.title }}" />
        </div>
        <div class="absolute top-3 left-3 flex items-center px-[6.85px] md:px-[11px] md:py-[5px] py-[3.11px] rounded-full z-10"
            style="background-color: {{ rating_bg_color }}; color: {{ rating_color }};">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9.64054 2.62525C9.57675 2.51143 9.48378 2.41667 9.3712 2.35072C9.25863 2.28477 9.13051 2.25 9.00004 2.25C8.86957 2.25 8.74145 2.28477 8.62888 2.35072C8.5163 2.41667 8.42333 2.51143 8.35954 2.62525C8.20954 2.89825 8.06529 3.17475 7.92679 3.45475C7.49044 4.34046 7.11945 5.25691 6.81679 6.19675C6.71254 6.52 6.40354 6.74425 6.04954 6.754C4.97645 6.78221 3.90686 6.88874 2.84929 7.07275C2.26879 7.17475 2.05054 7.83625 2.46304 8.23975C2.55704 8.33225 2.65204 8.4235 2.74804 8.5135C3.46584 9.19139 4.22478 9.82434 5.02054 10.4087C5.29579 10.6105 5.40904 10.9562 5.30404 11.2727C4.90406 12.475 4.6178 13.7122 4.44904 14.968C4.37404 15.5342 4.98004 15.934 5.50654 15.664C6.55057 15.1287 7.54892 14.5086 8.49154 13.81C8.63918 13.7022 8.81725 13.6442 9.00004 13.6442C9.18283 13.6442 9.3609 13.7022 9.50854 13.81C10.451 14.5089 11.4493 15.129 12.4935 15.664C13.0193 15.934 13.626 15.5342 13.551 14.968C13.522 14.7555 13.4903 14.5442 13.4558 14.3342C13.2825 13.2955 13.0285 12.2719 12.696 11.2727C12.591 10.9562 12.7035 10.6105 12.9795 10.4087C13.8823 9.74724 14.737 9.02242 15.537 8.23975C15.9495 7.83625 15.732 7.17475 15.1508 7.07275C14.0934 6.88767 13.0237 6.78113 11.9505 6.754C11.7809 6.7513 11.6162 6.69634 11.4789 6.59662C11.3416 6.4969 11.2383 6.35726 11.1833 6.19675C10.7848 4.95975 10.2682 3.76324 9.64054 2.62525Z" 
                fill="{{ rating_color }}"/>
                </svg>
                
            {# Generate a random rating between 4.1 and 5.0, rounded to 1 decimal place #}
            {% set random_rating = (4 + (range(1, 10) | random) / 10.0) | float %}
            <span class="md:text-lg text-xs font-medium leading-[100%]" style="color: {{ rating_color }};">
                {{ random_rating | round(1) }}
            </span>
        </div>
    </div>

    <div class="flex-1 p-4 flex flex-col items-center gap-4">
        <div class="flex-1 w-full flex flex-col gap-2.5 items-center">
            <p class="w-full text-center leading-[150%] truncate collection-title" style="
                color: {{ title_color }};
            ">

                {{ collection.title }}
            </p>
            {% if collection.description %}
            <p class="w-full text-center leading-[150%] truncate line-clamp-2 collection-description"
                style="color: {{ description_color }};"">{{ collection.description }}</p>
            {% endif %}
        </div>
        <button
            onclick="event.stopPropagation(); event.preventDefault(); window.location.href='/collection/{{ collection.slug }}';"
            class="flex items-start justify-center w-full collection-button"
            style="background-color: {{ button_bg_color }}; color: {{ button_text_color }};  border-radius: {{  '8' if card_border_radius else '0' }}px; padding: {{ button_padding_y }}px 0;">
            {{button_text}}
        </button>
    </div>
</a>

<style>
      .collection-title {
        font-size: {{ title_size * 0.7 }}px;
      }
      .collection-description {
        font-size: {{ description_size * 0.7 }}px;
      }
      @media (min-width: 720px) {
        .collection-title {
          font-size: {{ title_size }}px;
        }
        .collection-description {
          font-size: {{ description_size }}px;
        }
      }
</style>
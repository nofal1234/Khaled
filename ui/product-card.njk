{% set product = data.product %}
<a href="/product/{{ product.slug }}"
    class="product-card w-full h-full bg-white rounded-lg border border-gray overflow-hidden flex flex-col">
    <!-- Image Section with Swiper -->
    <div
        class="relative group overflow-hidden bg-bgItem flex items-center justify-center product-card-swiper-container product-card__image-wrapper">
        <div class="swiper product-card-swiper-{{ product._id }} w-full h-full ">
            <div class="swiper-wrapper">
                {% if product.images and (product.images | length) > 0 %}
                {% for image in product.images %}
                <div
                    class="swiper-slide flex items-center justify-center  pt-[34px] md:pt-[56px] md:pb-[42px]  pb-[26px] px-[47px]  md:px-[57px]">
                    <img src="{% if image.url %}{{ image.url | assets }}{% else %}{{ image.fileUrl  | default('https://placehold.co/320x420/eeeeee/666?text=No+Image') }}{% endif %}"
                        class="object-contain md:h-[226px] min-w-[94px] h-[141px] group-hover:scale-105 transition-all duration-300"
                        alt="{{ product.title }}" />
                </div>
                {% endfor %}
                {% else %}
                <div class="swiper-slide flex items-center justify-center">
                    <img src="https://placehold.co/320x420/eeeeee/666?text=No+Image"
                        class="object-contain group-hover:scale-105 transition-all duration-300"
                        alt="{{ product.title }}" />
                </div>
                {% endif %}
            </div>
        </div>
        {% if product.images and (product.images | length) > 1 %}
        <div class="swiper-pagination product-card-pagination-{{ product._id }}"></div>
        {% endif %}
        <button
            class="absolute top-3 right-3 bg-white rounded-full md:w-10 md:h-10 w-[25px] h-[25px] flex items-center justify-center hover:bg-gray-100 transition z-10 wishlist-heart-btn"
            data-product-id="{{ product._id }}" data-product-title="{{ product.title }}"
            data-product-slug="{{ product.slug }}"
            data-product-image="{{ (product.images[0].fileUrl ) if product.images and product.images[0] else 'https://placehold.co/320x420/eeeeee/666?text=No+Image' }}"
            data-product-price="{{ product.pricing.price }}" {% if product.pricing.compareAtPrice %}
            data-product-compare-at-price="{{ product.pricing.compareAtPrice }}" {% endif %}
            onclick="event.stopPropagation(); event.preventDefault(); if(window.toggleWishlistFromElement){ window.toggleWishlistFromElement(this); } else if(window.toggleWishlist){ window.toggleWishlist('{{ product._id }}'); }">
            <i class="ph ph-heart md:text-xl text-[11px]"></i>
        </button>
        {% if product.averageRating %}
        <div
            class="absolute top-3 left-3 bg-white flex items-center text-black px-[6.85px]  md:px-[11px] md:py-[5px] py-[3.11px] rounded-full z-10">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M9.64011 2.62476C9.57632 2.51095 9.48335 2.41619 9.37078 2.35023C9.2582 2.28428 9.13009 2.24951 8.99961 2.24951C8.86914 2.24951 8.74102 2.28428 8.62845 2.35023C8.51587 2.41619 8.42291 2.51095 8.35911 2.62476C8.20911 2.89776 8.06486 3.17426 7.92636 3.45426C7.49001 4.33998 7.11902 5.25642 6.81636 6.19626C6.71211 6.51951 6.40311 6.74376 6.04911 6.75351C4.97603 6.78172 3.90643 6.88825 2.84886 7.07226C2.26836 7.17426 2.05011 7.83576 2.46261 8.23926C2.55661 8.33176 2.65161 8.42301 2.74761 8.51301C3.46541 9.1909 4.22435 9.82385 5.02011 10.4083C5.29536 10.61 5.40861 10.9558 5.30361 11.2723C4.90363 12.4745 4.61738 13.7117 4.44861 14.9675C4.37361 15.5338 4.97961 15.9335 5.50611 15.6635C6.55014 15.1282 7.54849 14.5081 8.49111 13.8095C8.63876 13.7017 8.81682 13.6437 8.99961 13.6437C9.1824 13.6437 9.36047 13.7017 9.50811 13.8095C10.4505 14.5084 11.4489 15.1285 12.4931 15.6635C13.0189 15.9335 13.6256 15.5338 13.5506 14.9675C13.5216 14.755 13.4899 14.5438 13.4554 14.3338C13.2821 13.2951 13.0281 12.2715 12.6956 11.2723C12.5906 10.9558 12.7031 10.61 12.9791 10.4083C13.8819 9.74675 14.7366 9.02193 15.5366 8.23926C15.9491 7.83576 15.7316 7.17426 15.1504 7.07226C14.0929 6.88718 13.0233 6.78064 11.9501 6.75351C11.7804 6.75081 11.6157 6.69585 11.4784 6.59613C11.3411 6.49641 11.2379 6.35678 11.1829 6.19626C10.7844 4.95926 10.2678 3.76275 9.64011 2.62476Z"
                    fill="#EBB11F" />
            </svg>
            <span class="md:text-lg text-xs font-semibold leading-[100%]">
                {{ (product.averageRating | round(0, 'floor')) ~ '.0' }}
            </span>
        </div>
        {% endif %}
    </div>

    <!-- Content Section -->
    <div class="md:p-4 py-[3.5px] px-2.5 flex flex-col md:gap-3 gap-1 flex-1">
        <div class=" flex flex-col md:gap-[10px] gap-1 flex-1 ">

            <h3 class="md:text-lg text-sm font-bold" style="
                {% if data.card_title_color %}color: {{ data.card_title_color }};{% endif %}
                {% if data.card_title_size %}font-size: {{ data.card_title_size }}px;{% endif %}
            ">
                {{ product.title }}
            </h3>
            {% if product.description %}
            <p class="font-semibold line-clamp-2" style="
               {% if data.card_description_color %}color: {{ data.card_description_color }};{% endif %}
               {% if data.card_description_size %}font-size: {{ data.card_description_size }}px;{% endif %}
           ">
                {{ product.description | striptags }}
            </p>
            {% endif %}
        </div>
        <!-- Price Section -->
        <div class="flex md:flex-row flex-col md:items-end gap-3 mt-auto justify-between product-card__price-row">
            <div class="flex flex-col flex-1 gap-1">
                {% if product.pricing.compareAtPrice %}
                <div class="flex items-center gap-2 flex-wrap">
                    <span class="line-through" style="
                              {% if data.price_before_color %}color: {{ data.price_before_color }};{% endif %}
                              {% if data.price_before_size %}font-size: {{ data.price_before_size }}px;{% endif %}
                          ">
                        {{ product.pricing.compareAtPrice | money }}
                    </span>
                    <span class="font-bold" style="
                              {% if data.discount_color %}color: {{ data.discount_color }};{% endif %}
                              {% if data.discount_size %}font-size: {{ data.discount_size }}px;{% endif %}
                          ">
                        -{{ ((1 - (product.pricing.price / product.pricing.compareAtPrice)) * 100) | round(0, 'floor')
                        }}%
                    </span>
                </div>
                {% endif %}
                <span class="font-bold whitespace-nowrap" style="
                          {% if data.data.price_color %}color: {{ data.data.price_color }};{% endif %}
                          {% if data.data.price_size %}font-size: {{ data.data.price_size }}px;{% endif %}
                      ">
                    {{ product.pricing.price | money }}
                </span>
            </div>
            {%log "variantsCount",product.variantsCount  > 0%}
            {% if product.variantsCount  > 0%}
              <button onclick="window.location='/product/{{ product.slug }}'" class="w-full h-[26px] md:w-12 md:h-12 gap-1 rounded-full font-bold
                hover:bg-gray-800 transition flex items-center justify-center flex-shrink-0" style="
             {% if data.buy_button_bg %}background: {{ data.buy_button_bg }};{% endif %}
             color: #fff
         " title="تفاصل المنتج">
                <i class="ph ph-eye md:text-xl text-xs"></i>
                <span class=" text-xs font-medium md:hidden">{{t("product_details")}}</span>
            </button>
            {% else %}
            <button
            onclick="if(typeof window.addProductToCart === 'function') { window.addProductToCart('{{ product._id }}', 1, []); event.stopPropagation(); event.preventDefault(); }"
            class="w-full h-[26px] md:w-12 md:h-12 gap-1 rounded-full font-bold
                   hover:bg-gray-800 transition flex items-center justify-center flex-shrink-0" style="
                {% if data.buy_button_bg %}background: {{ data.buy_button_bg }};{% endif %}
                color: #fff
            " title="إضافة للسلة">
            <i class="ph ph-shopping-cart  md:text-xl text-xs"></i>
            <span class=" text-xs font-medium md:hidden">{{t("add_to_cart")}}</span>
        </button>
            {% endif %}
        </div>
    </div>
</a>

<script>
    function initProductCardSwipers() {
        const productCardContainers = document.querySelectorAll('.product-card-swiper-container');
        productCardContainers.forEach((container) => {
            const swiperElement = container.querySelector('.swiper');
            if (!swiperElement) return;

            const swiperClass = swiperElement.className.split(' ').find(cls => cls.startsWith('product-card-swiper-'));
            if (!swiperClass) return;
            if (swiperElement.swiper) return;

            const paginationElement = container.querySelector('.swiper-pagination');
            const slides = swiperElement.querySelectorAll('.swiper-slide');
            if (slides.length > 1 && window.Swiper) {
                new Swiper(swiperElement, {
                    slidesPerView: 1,
                    spaceBetween: 0,
                    loop: false,
                    grabCursor: true,
                    pagination: paginationElement ? {
                        el: paginationElement,
                        clickable: true,
                        dynamicBullets: false
                    } : false,
                    autoplay: false,
                    speed: 300,
                    allowTouchMove: true
                });
            }
        });
    }
    initProductCardSwipers();
    const observer = new MutationObserver(() => {
        initProductCardSwipers();
    });
    observer.observe(document.body, {
        childList: true,
        subtree: true
    });
</script>

<style>
    /* Product Card Swiper Styles */
    .product-card {
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .product-card__image-wrapper {
        min-height: 260px;
    }

    .offerSwiper .swiper-slide,
    .categorySwiper .swiper-slide {
        display: flex;
        height: auto;
    }

    .offerSwiper .swiper-slide>.product-card,
    .categorySwiper .swiper-slide>.product-card {
        height: 100%;
    }

    .product-card-swiper-container .swiper {
        width: 100%;
        height: 100%;
    }

    .product-card-swiper-container .swiper-slide {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .product-card-swiper-container .swiper-pagination {
        bottom: 16px !important;
        left: 50% !important;
        transform: translateX(-50%);
        width: auto !important;
    }

    .product-card-swiper-container .swiper-pagination-bullet {
        width: 6px;
        height: 6px;
        background: rgba(0, 0, 0, 0.4);
        opacity: 1;
        margin: 0 3px;
        transition: all 0.3s ease;
    }

    .product-card-swiper-container .swiper-pagination-bullet-active {
        background: #000;
        width: 6px;
        border-radius: 50%;
    }
</style>